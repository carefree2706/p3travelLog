{"ast":null,"code":"import _regeneratorRuntime from\"/Users/thedon/Desktop/uadel-adel-fsf-pt-11-2020-u-c/uadel-adel-fsf-pt-11-2020-u-c/p3travelLog/client/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/Users/thedon/Desktop/uadel-adel-fsf-pt-11-2020-u-c/uadel-adel-fsf-pt-11-2020-u-c/p3travelLog/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/Users/thedon/Desktop/uadel-adel-fsf-pt-11-2020-u-c/uadel-adel-fsf-pt-11-2020-u-c/p3travelLog/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/thedon/Desktop/uadel-adel-fsf-pt-11-2020-u-c/uadel-adel-fsf-pt-11-2020-u-c/p3travelLog/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/thedon/Desktop/uadel-adel-fsf-pt-11-2020-u-c/uadel-adel-fsf-pt-11-2020-u-c/p3travelLog/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import\"./app.css\";import ReactMapGL,{Marker,Popup}from\"react-map-gl\";import{useEffect,useState}from\"react\";import{Room,Star}from\"@material-ui/icons\";import axios from\"axios\";import{format}from\"timeago.js\";import Register from\"./components/Register\";import Login from\"./components/Login\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function App(){var myStorage=window.localStorage;var _useState=useState(myStorage.getItem(\"user\")),_useState2=_slicedToArray(_useState,2),currentUsername=_useState2[0],setCurrentUsername=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),pins=_useState4[0],setPins=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),currentPlaceId=_useState6[0],setCurrentPlaceId=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),newPlace=_useState8[0],setNewPlace=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),title=_useState10[0],setTitle=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),desc=_useState12[0],setDesc=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),star=_useState14[0],setStar=_useState14[1];var _useState15=useState({latitude:47.040182,longitude:17.071727,zoom:4}),_useState16=_slicedToArray(_useState15,2),viewport=_useState16[0],setViewport=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),showRegister=_useState18[0],setShowRegister=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),showLogin=_useState20[0],setShowLogin=_useState20[1];var handleMarkerClick=function handleMarkerClick(id,lat,long){setCurrentPlaceId(id);setViewport(_objectSpread(_objectSpread({},viewport),{},{latitude:lat,longitude:long}));};var handleAddClick=function handleAddClick(e){var _e$lngLat=_slicedToArray(e.lngLat,2),longitude=_e$lngLat[0],latitude=_e$lngLat[1];setNewPlace({lat:latitude,long:longitude});};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var newPin,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();newPin={username:currentUsername,title:title,desc:desc,rating:star,lat:newPlace.lat,long:newPlace.long};_context.prev=2;_context.next=5;return axios.post(\"/pins\",newPin);case 5:res=_context.sent;setPins([].concat(_toConsumableArray(pins),[res.data]));setNewPlace(null);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](2);console.log(_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[2,10]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();useEffect(function(){var getPins=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var allPins;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.get(\"/pins\");case 3:allPins=_context2.sent;setPins(allPins.data);_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return function getPins(){return _ref2.apply(this,arguments);};}();getPins();},[]);var handleLogout=function handleLogout(){setCurrentUsername(null);myStorage.removeItem(\"user\");};return/*#__PURE__*/_jsx(\"div\",{style:{height:\"100vh\",width:\"100%\"},children:/*#__PURE__*/_jsxs(ReactMapGL,_objectSpread(_objectSpread({},viewport),{},{mapboxApiAccessToken:process.env.REACT_APP_MAPBOX,width:\"100%\",height:\"100%\",transitionDuration:\"20\",mapStyle:\"mapbox://styles/donaldwu/ckp4oxxuq1s1q17mz2k2989vc\",onViewportChange:function onViewportChange(viewport){return setViewport(viewport);},onDblClick:currentUsername&&handleAddClick,children:[pins.map(function(p){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Marker,{latitude:p.lat,longitude:p.long,offsetLeft:-3.5*viewport.zoom,offsetTop:-7*viewport.zoom,children:/*#__PURE__*/_jsx(Room,{style:{fontSize:7*viewport.zoom,color:currentUsername===p.username?\"tomato\":\"slateblue\",cursor:\"pointer\"},onClick:function onClick(){return handleMarkerClick(p._id,p.lat,p.long);}})}),p._id===currentPlaceId&&/*#__PURE__*/_jsx(Popup,{latitude:p.lat,longitude:p.long,closeButton:true,closeOnClick:false,onClose:function onClose(){return setCurrentPlaceId(null);},anchor:\"left\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Place\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"place\",children:p.title}),/*#__PURE__*/_jsx(\"label\",{children:\"Review\"}),/*#__PURE__*/_jsx(\"p\",{className:\"desc\",children:p.desc}),/*#__PURE__*/_jsx(\"label\",{children:\"Rating\"}),/*#__PURE__*/_jsx(\"div\",{className:\"stars\",children:Array(p.rating).fill(/*#__PURE__*/_jsx(Star,{className:\"star\"}))}),/*#__PURE__*/_jsx(\"label\",{children:\"Information\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"username\",children:[\"Created by \",/*#__PURE__*/_jsx(\"b\",{children:p.username})]}),/*#__PURE__*/_jsx(\"span\",{className:\"date\",children:format(p.createdAt)})]})},p._id)]});}),newPlace&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Marker,{latitude:newPlace.lat,longitude:newPlace.long,offsetLeft:-3.5*viewport.zoom,offsetTop:-7*viewport.zoom,children:/*#__PURE__*/_jsx(Room,{style:{fontSize:7*viewport.zoom,color:\"tomato\",cursor:\"pointer\"}})}),/*#__PURE__*/_jsx(Popup,{latitude:newPlace.lat,longitude:newPlace.long,closeButton:true,closeOnClick:false,onClose:function onClose(){return setNewPlace(null);},anchor:\"left\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Title\"}),/*#__PURE__*/_jsx(\"input\",{placeholder:\"Enter a title\",autoFocus:true,onChange:function onChange(e){return setTitle(e.target.value);}}),/*#__PURE__*/_jsx(\"label\",{children:\"Description\"}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Say us something about this place.\",onChange:function onChange(e){return setDesc(e.target.value);}}),/*#__PURE__*/_jsx(\"label\",{children:\"Rating\"}),/*#__PURE__*/_jsxs(\"select\",{onChange:function onChange(e){return setStar(e.target.value);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"1\",children:\"1\"}),/*#__PURE__*/_jsx(\"option\",{value:\"2\",children:\"2\"}),/*#__PURE__*/_jsx(\"option\",{value:\"3\",children:\"3\"}),/*#__PURE__*/_jsx(\"option\",{value:\"4\",children:\"4\"}),/*#__PURE__*/_jsx(\"option\",{value:\"5\",children:\"5\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"submitButton\",children:\"Add Pin\"})]})})})]}),currentUsername?/*#__PURE__*/_jsx(\"button\",{className:\"button logout\",onClick:handleLogout,children:\"Log out\"}):/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"button login\",onClick:function onClick(){return setShowLogin(true);},children:\"Log in\"}),/*#__PURE__*/_jsx(\"button\",{className:\"button register\",onClick:function onClick(){return setShowRegister(true);},children:\"Register\"})]}),showRegister&&/*#__PURE__*/_jsx(Register,{setShowRegister:setShowRegister}),showLogin&&/*#__PURE__*/_jsx(Login,{setShowLogin:setShowLogin,setCurrentUsername:setCurrentUsername,myStorage:myStorage})]}))});}export default App;","map":{"version":3,"sources":["/Users/thedon/Desktop/uadel-adel-fsf-pt-11-2020-u-c/uadel-adel-fsf-pt-11-2020-u-c/p3travelLog/client/src/App.js"],"names":["ReactMapGL","Marker","Popup","useEffect","useState","Room","Star","axios","format","Register","Login","App","myStorage","window","localStorage","getItem","currentUsername","setCurrentUsername","pins","setPins","currentPlaceId","setCurrentPlaceId","newPlace","setNewPlace","title","setTitle","desc","setDesc","star","setStar","latitude","longitude","zoom","viewport","setViewport","showRegister","setShowRegister","showLogin","setShowLogin","handleMarkerClick","id","lat","long","handleAddClick","e","lngLat","handleSubmit","preventDefault","newPin","username","rating","post","res","data","console","log","getPins","get","allPins","handleLogout","removeItem","height","width","process","env","REACT_APP_MAPBOX","map","p","fontSize","color","cursor","_id","Array","fill","createdAt","target","value"],"mappings":"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","sourcesContent":["import \"./app.css\";\nimport ReactMapGL, { Marker, Popup } from \"react-map-gl\";\nimport { useEffect, useState } from \"react\";\nimport { Room, Star } from \"@material-ui/icons\";\nimport axios from \"axios\";\nimport { format } from \"timeago.js\";\nimport Register from \"./components/Register\";\nimport Login from \"./components/Login\";\n\nfunction App() {\n  const myStorage = window.localStorage;\n  const [currentUsername, setCurrentUsername] = useState(myStorage.getItem(\"user\"));\n  const [pins, setPins] = useState([]);\n  const [currentPlaceId, setCurrentPlaceId] = useState(null);\n  const [newPlace, setNewPlace] = useState(null);\n  const [title, setTitle] = useState(null);\n  const [desc, setDesc] = useState(null);\n  const [star, setStar] = useState(0);\n  const [viewport, setViewport] = useState({\n    latitude: 47.040182,\n    longitude: 17.071727,\n    zoom: 4,\n  });\n  const [showRegister, setShowRegister] = useState(false);\n  const [showLogin, setShowLogin] = useState(false);\n\n  const handleMarkerClick = (id, lat, long) => {\n    setCurrentPlaceId(id);\n    setViewport({ ...viewport, latitude: lat, longitude: long });\n  };\n\n  const handleAddClick = (e) => {\n    const [longitude, latitude] = e.lngLat;\n    setNewPlace({\n      lat: latitude,\n      long: longitude,\n    });\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    const newPin = {\n      username: currentUsername,\n      title,\n      desc,\n      rating: star,\n      lat: newPlace.lat,\n      long: newPlace.long,\n    };\n\n    try {\n      const res = await axios.post(\"/pins\", newPin);\n      setPins([...pins, res.data]);\n      setNewPlace(null);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  useEffect(() => {\n    const getPins = async () => {\n      try {\n        const allPins = await axios.get(\"/pins\");\n        setPins(allPins.data);\n      } catch (err) {\n        console.log(err);\n      }\n    };\n    getPins();\n  }, []);\n\n  const handleLogout = () => {\n    setCurrentUsername(null);\n    myStorage.removeItem(\"user\");\n  };\n\n  return (\n    <div style={{ height: \"100vh\", width: \"100%\" }}>\n      <ReactMapGL\n        {...viewport}\n        mapboxApiAccessToken={process.env.REACT_APP_MAPBOX}\n        width=\"100%\"\n        height=\"100%\"\n        transitionDuration=\"20\"\n        mapStyle=\"mapbox://styles/donaldwu/ckp4oxxuq1s1q17mz2k2989vc\"\n        onViewportChange={(viewport) => setViewport(viewport)}\n        onDblClick={currentUsername && handleAddClick}\n      >\n        {pins.map((p) => (\n          <>\n            <Marker\n              latitude={p.lat}\n              longitude={p.long}\n              offsetLeft={-3.5 * viewport.zoom}\n              offsetTop={-7 * viewport.zoom}\n            >\n              <Room\n                style={{\n                  fontSize: 7 * viewport.zoom,\n                  color:\n                    currentUsername === p.username ? \"tomato\" : \"slateblue\",\n                  cursor: \"pointer\",\n                }}\n                onClick={() => handleMarkerClick(p._id, p.lat, p.long)}\n              />\n            </Marker>\n            {p._id === currentPlaceId && (\n              <Popup\n                key={p._id}\n                latitude={p.lat}\n                longitude={p.long}\n                closeButton={true}\n                closeOnClick={false}\n                onClose={() => setCurrentPlaceId(null)}\n                anchor=\"left\"\n              >\n                <div className=\"card\">\n                  <label>Place</label>\n                  <h4 className=\"place\">{p.title}</h4>\n                  <label>Review</label>\n                  <p className=\"desc\">{p.desc}</p>\n                  <label>Rating</label>\n                  <div className=\"stars\">\n                    {Array(p.rating).fill(<Star className=\"star\" />)}\n                  </div>\n                  <label>Information</label>\n                  <span className=\"username\">\n                    Created by <b>{p.username}</b>\n                  </span>\n                  <span className=\"date\">{format(p.createdAt)}</span>\n                </div>\n              </Popup>\n            )}\n          </>\n        ))}\n        {newPlace && (\n          <>\n            <Marker\n              latitude={newPlace.lat}\n              longitude={newPlace.long}\n              offsetLeft={-3.5 * viewport.zoom}\n              offsetTop={-7 * viewport.zoom}\n            >\n              <Room\n                style={{\n                  fontSize: 7 * viewport.zoom,\n                  color: \"tomato\",\n                  cursor: \"pointer\",\n                }}\n              />\n            </Marker>\n            <Popup\n              latitude={newPlace.lat}\n              longitude={newPlace.long}\n              closeButton={true}\n              closeOnClick={false}\n              onClose={() => setNewPlace(null)}\n              anchor=\"left\"\n            >\n              <div>\n                <form onSubmit={handleSubmit}>\n                  <label>Title</label>\n                  <input\n                    placeholder=\"Enter a title\"\n                    autoFocus\n                    onChange={(e) => setTitle(e.target.value)}\n                  />\n                  <label>Description</label>\n                  <textarea\n                    placeholder=\"Say us something about this place.\"\n                    onChange={(e) => setDesc(e.target.value)}\n                  />\n                  <label>Rating</label>\n                  <select onChange={(e) => setStar(e.target.value)}>\n                    <option value=\"1\">1</option>\n                    <option value=\"2\">2</option>\n                    <option value=\"3\">3</option>\n                    <option value=\"4\">4</option>\n                    <option value=\"5\">5</option>\n                  </select>\n                  <button type=\"submit\" className=\"submitButton\">\n                    Add Pin\n                  </button>\n                </form>\n              </div>\n            </Popup>\n          </>\n        )}\n        {currentUsername ? (\n          <button className=\"button logout\" onClick={handleLogout}>\n            Log out\n          </button>\n        ) : (\n          <div className=\"buttons\">\n            <button className=\"button login\" onClick={() => setShowLogin(true)}>\n              Log in\n            </button>\n            <button\n              className=\"button register\"\n              onClick={() => setShowRegister(true)}\n            >\n              Register\n            </button>\n          </div>\n        )}\n        {showRegister && <Register setShowRegister={setShowRegister} />}\n        {showLogin && (\n          <Login\n            setShowLogin={setShowLogin}\n            setCurrentUsername={setCurrentUsername}\n            myStorage={myStorage}\n          />\n        )}\n      </ReactMapGL>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}